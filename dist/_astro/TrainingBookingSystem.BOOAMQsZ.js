import{j as a}from"./jsx-runtime.D_zvdyIk.js";import{R as c,r as l}from"./index.CT7zvmi-.js";/* empty css                          */import"./index.B0_VcSax.js";var B={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},P=c.createContext&&c.createContext(B),$=["attr","size","title"];function R(e,t){if(e==null)return{};var r=H(e,t),o,s;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(s=0;s<d.length;s++)o=d[s],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}function H(e,t){if(e==null)return{};var r={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;r[o]=e[o]}return r}function x(){return x=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},x.apply(this,arguments)}function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,o)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?C(Object(r),!0).forEach(function(o){L(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function L(e,t,r){return t=q(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q(e){var t=G(e,"string");return typeof t=="symbol"?t:t+""}function G(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var o=r.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function E(e){return e&&e.map((t,r)=>c.createElement(t.tag,y({key:r},t.attr),E(t.child)))}function K(e){return t=>c.createElement(V,x({attr:y({},e.attr)},t),E(e.child))}function V(e){var t=r=>{var{attr:o,size:s,title:d}=e,u=R(e,$),g=s||r.size||"1em",m;return r.className&&(m=r.className),e.className&&(m=(m?m+" ":"")+e.className),c.createElement("svg",x({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,o,u,{className:m,style:y(y({color:e.color||r.color},r.style),e.style),height:g,width:g,xmlns:"http://www.w3.org/2000/svg"}),d&&c.createElement("title",null,d),e.children)};return P!==void 0?c.createElement(P.Consumer,null,r=>t(r)):t(B)}function W(e){return K({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(e)}function D(e){const t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}function A(){const e=[],t=new Date;for(let r=0;r<4;r++){const o=new Date(t);o.setDate(t.getDate()+(9-t.getDay())%7+r*7);const s=o.toISOString().slice(0,10);e.push({id:`${s}-u13-1`,date:s,time:"18:30-19:30",group:"U13s",enabled:!0,booked:!1},{id:`${s}-u13-2`,date:s,time:"18:30-19:30",group:"U13s",enabled:!0,booked:!1},{id:`${s}-u15-1`,date:s,time:"19:30-20:30",group:"U15s+",enabled:!0,booked:!1},{id:`${s}-u15-2`,date:s,time:"19:30-20:30",group:"U15s+",enabled:!0,booked:!1})}return e}const Z=({inviteToken:e})=>{const[t,r]=l.useState(A()),[o,s]=l.useState(null),[d,u]=l.useState(!1),[g,m]=l.useState(e||null),[f,h]=l.useState(null),[N,v]=l.useState(null),[j,z]=l.useState(!1),[F,I]=l.useState(null),k=c.useRef(null),T={u13:"U13s",u15plus:"U15s+"};c.useEffect(()=>{try{const n=new URLSearchParams(window.location.search),i=n.get("invite"),p=n.get("date"),b=n.get("slot");if(i&&!g&&m(i),p&&b){const U=T[b]||b,S=t.find(O=>O.date===p&&O.group===U);S&&(s(S),u(!0))}}catch{}},[]),c.useEffect(()=>{f&&k.current&&k.current.focus()},[f]);const w=n=>{s(n),u(!0)},M=()=>{u(!1),s(null)},_=async()=>{if(o){if(g){h("Booking in progress..."),v(null);try{const n=await fetch("/api/booking.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({invite:g,session_date:o.date})}),i=await n.json();if(!n.ok||!i.ok)throw new Error(i.error||"Booking failed");r(p=>p.map(b=>b.id===o.id?{...b,booked:!0}:b)),z(!0),I(i.booking||null),h("Booking confirmed — check your email for confirmation."),v("success")}catch(n){h("Booking failed: "+(n?.message||String(n))),v("error")}finally{u(!1),s(null)}return}r(n=>n.map(i=>i.id===o.id?{...i,booked:!0}:i)),u(!1),s(null),h("Booking reserved locally (dev mode)"),v("success")}};return a.jsxs("div",{className:"max-w-3xl mx-auto py-8",children:[a.jsxs("div",{className:"bookings-hero",children:[a.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Book a Training Session"}),a.jsx("p",{className:"bookings-lead",children:"Choose a session below to reserve a free taster. If you received an invite, use the booking link provided in your email."})]}),a.jsx("div",{"aria-live":"polite","aria-atomic":"true",tabIndex:-1,ref:k,style:{outline:"none"},children:f?a.jsx("div",{className:`p-3 mb-4 rounded ${N==="success"?"bg-green-50 border border-green-200 text-green-800":N==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-gray-50 border border-gray-200 text-gray-800"}`,role:"status",children:f}):null}),a.jsx("div",{className:"booking-grid",children:t.map(n=>a.jsxs("div",{className:`booking-card p-4 border rounded-lg shadow cursor-pointer transition ${n.booked?"bg-gray-200 border-gray-400 cursor-not-allowed":"card"}`,onClick:()=>!n.booked&&n.enabled&&w(n),"aria-disabled":n.booked||!n.enabled,role:"button",tabIndex:n.booked||!n.enabled?-1:0,onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&!n.booked&&n.enabled&&w(n)},children:[a.jsxs("div",{className:"booking-meta",children:[a.jsx(W,{style:{color:"var(--blue)"}}),a.jsxs("div",{children:[a.jsx("div",{className:"font-semibold",children:D(n.date)}),a.jsxs("div",{className:"text-sm bookings-lead",children:[n.time," • ",a.jsx("span",{className:"booking-slot-group",children:n.group})]})]})]}),a.jsx("div",{className:"mt-2 text-sm text-gray-700",children:n.booked?a.jsxs("strong",{children:["Booked",n.booker?` by ${n.booker}`:""]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Available"}),a.jsx("div",{className:"text-sm text-gray-600",children:"Slots: 2"})]})}),!n.enabled&&!n.booked&&a.jsx("div",{className:"mt-2 text-sm text-red-600",children:a.jsx("strong",{children:"Unavailable"})}),a.jsxs("div",{className:"slot-actions",children:[a.jsx("button",{onClick:()=>!n.booked&&n.enabled&&w(n),disabled:j||n.booked||!n.enabled,className:`btn-primary ${j||n.booked||!n.enabled?"opacity-50 cursor-not-allowed":""}`,children:n.booked||j?"Booked":"Book"}),a.jsx("button",{onClick:()=>alert("More info coming soon"),className:"bg-gray-100 text-gray-800 py-2 px-4 rounded hover:bg-gray-200",children:"Details"})]})]},n.id))}),d&&o&&a.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 booking-modal-backdrop",children:a.jsxs("div",{className:"card p-6 rounded-lg shadow-xl booking-modal",children:[a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Confirm Booking"}),a.jsxs("p",{className:"mb-2",children:[a.jsx("strong",{children:"Date:"})," ",D(o.date)]}),a.jsxs("p",{className:"mb-2",children:[a.jsx("strong",{children:"Time:"})," ",o.time]}),a.jsxs("p",{className:"mb-4",children:[a.jsx("strong",{children:"Group:"})," ",o.group]}),a.jsxs("div",{className:"flex gap-4",children:[a.jsx("button",{onClick:_,className:"flex-1 btn-primary",children:"Confirm booking"}),a.jsx("button",{onClick:M,className:"flex-1 bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400",children:"Cancel"})]})]})})]})};export{Z as default};
