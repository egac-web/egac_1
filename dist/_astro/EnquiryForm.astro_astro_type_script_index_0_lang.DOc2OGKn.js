document.addEventListener("DOMContentLoaded",()=>{function _(t){const i=t.querySelector('[name="interest"]').value,l=t.querySelector("#dob"),c=t.querySelector("#dob_alt"),f=t.querySelector("#message"),u=t.querySelector("#message_alt"),e=t.querySelector('[name="enquiry_for"]:checked'),d=e?e.value:t.querySelector('[name="enquiry_for"]')?t.querySelector('[name="enquiry_for"]').value:"",n=d==="someone_else"||d==="child";if(l){const r=l.closest(".form-group");i==="Training"?(r.style.display="",r.removeAttribute("x-cloak")):(r.style.display="none",r.setAttribute("x-cloak","")),l.required=i==="Training"}if(c){const r=c.closest(".form-group");i==="Training"?(r.style.display="",r.removeAttribute("x-cloak")):(r.style.display="none",r.setAttribute("x-cloak","")),c.required=i==="Training"}if(f){const r=f.closest(".form-group");i==="Other"?(r.style.display="",r.removeAttribute("x-cloak")):(r.style.display="none",r.setAttribute("x-cloak","")),f.required=i==="Other"}if(u){const r=u.closest(".form-group");i==="Other"?(r.style.display="",r.removeAttribute("x-cloak")):(r.style.display="none",r.setAttribute("x-cloak","")),u.required=i==="Other"}const y=t.querySelectorAll('[name="training_days"]');if(y&&y.length){const r=y[0].closest(".form-group");r&&(i==="Training"?(r.style.display="",r.removeAttribute("x-cloak")):(r.style.display="none",r.setAttribute("x-cloak","")))}const b=t.querySelector('[name="subject_first_name"]'),s=t.querySelector('[name="subject_last_name"]'),o=t.querySelector('[name="subject_dob"]');let a=null;Array.from(t.querySelectorAll(".form-group")).forEach(r=>{const q=r.querySelector(".form-label");q&&/Details of the person you are enquiring for/i.test(q.textContent||"")&&(a=r)}),a&&(n?(a.style.display="",a.removeAttribute("x-cloak")):(a.style.display="none",a.setAttribute("x-cloak",""))),b&&(b.required=n),s&&(s.required=n),o&&(o.required=n);const m=t.querySelector('[name="contact_phone"]');m&&(m.required=n)}document.querySelectorAll("form.enquiry-form").forEach(t=>{try{_(t)}catch{}const i=t.querySelector('[name="interest"]');i&&i.addEventListener("change",()=>_(t));const l=t.querySelectorAll('[name="enquiry_for"]');l&&l.length&&l.forEach(c=>c.addEventListener("change",()=>_(t))),t.addEventListener("submit",async c=>{c.preventDefault();const f=t.dataset.webhookUrl||"/api/enquiry.json",u=new FormData(t),e=Object.fromEntries(u.entries()),d=u.getAll("training_days");if(d&&d.length&&(e.training_days=d),!e.contact_name&&(t.querySelector("[name=first_name]")||t.querySelector("[name=last_name]"))){const s=t.querySelector("[name=first_name]")?.value||"",o=t.querySelector("[name=last_name]")?.value||"";e.contact_name=(s+" "+o).trim()}const n={};(!e.contact_name||!e.contact_name.trim())&&(n.contact_name="Please enter your name."),(!e.contact_email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.contact_email))&&(n.contact_email="Please enter a valid email address.");const y=e.enquiry_for==="someone_else"||e.enquiry_for==="child";if(e.interest==="Training"&&!(e.dob||y&&e.subject_dob)&&(y?n.subject_dob="Please provide the date of birth for the person you are enquiring for.":n.dob="Please provide a date of birth."),e.interest==="Other"&&(!e.message||!e.message.trim())&&(n.message="Please add a message."),(e.enquiry_for==="someone_else"||e.enquiry_for==="child")&&(e.contact_name&&e.contact_name.trim()||e.first_name&&e.first_name.trim()&&e.last_name&&e.last_name.trim()||(n.contact_name="Please enter your name."),(!e.contact_phone||!e.contact_phone.trim())&&(n.contact_phone="Please enter a phone number."),(!e.subject_first_name||!e.subject_first_name.trim())&&(n.subject_first_name="Please provide the first name of the person you are enquiring for."),(!e.subject_last_name||!e.subject_last_name.trim())&&(n.subject_last_name="Please provide the last name of the person you are enquiring for."),e.subject_dob||(n.subject_dob="Please provide the date of birth for the person you are enquiring for."),e.subject_dob&&(e.dob=e.subject_dob)),e.gdpr_consent===!0||e.gdpr_consent==="true"||e.gdpr_consent==="on"||(n.gdpr_consent="You must consent to data processing."),t.querySelectorAll(".form-field-error").forEach(s=>s.textContent=""),Object.keys(n).length){Object.entries(n).forEach(([s,o])=>{t.querySelector(`[name="${s}"]`),t.querySelector('[x-show][x-text][class*="form-field-error"]')||t.querySelector(".form-field-error");const a=t.querySelector(`.form-field-error[for="${s}"]`);if(a)a.textContent=o;else{const m=t.querySelector(`[name="${s}"]`);if(m){let r=m.parentElement.querySelector(".form-field-error");r&&(r.textContent=o)}}});return}try{const s=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const a=await s.json().catch(()=>null);throw new Error(a&&a.error?a.error:"Submission failed")}const o=t.querySelector(".form-success");o&&(o.style.display=""),t.reset(),_(t)}catch(s){const o=t.querySelector(".form-error");o&&(o.textContent=s.message||"Submission failed",o.style.display="")}})})});
