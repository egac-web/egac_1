import{j as o}from"./jsx-runtime.D_zvdyIk.js";import{R as u,r as y}from"./index.CT7zvmi-.js";/* empty css                          */import"./index.B0_VcSax.js";var H={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},M=u.createContext&&u.createContext(H),X=["attr","size","title"];function Z(e,t){if(e==null)return{};var n=ee(e,t),r,l;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(e);for(l=0;l<v.length;l++)r=v[l],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function ee(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function D(){return D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},D.apply(this,arguments)}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$(Object(n),!0).forEach(function(r){te(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function te(e,t,n){return t=ne(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ne(e){var t=re(e,"string");return typeof t=="symbol"?t:t+""}function re(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function U(e){return e&&e.map((t,n)=>u.createElement(t.tag,C({key:n},t.attr),U(t.child)))}function oe(e){return t=>u.createElement(ie,D({attr:C({},e.attr)},t),U(e.child))}function ie(e){var t=n=>{var{attr:r,size:l,title:v}=e,b=Z(e,X),c=l||n.size||"1em",j;return n.className&&(j=n.className),e.className&&(j=(j?j+" ":"")+e.className),u.createElement("svg",D({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,b,{className:j,style:C(C({color:e.color||n.color},n.style),e.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),v&&u.createElement("title",null,v),e.children)};return M!==void 0?u.createElement(M.Consumer,null,n=>t(n)):t(H)}function se(e){return oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(e)}const A=Symbol.for("constructDateFrom");function q(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&A in e?e[A](t):e instanceof Date?new e.constructor(t):new Date(t)}function ae(e,t){return q(e,e)}function Y(e,t,n){const r=ae(e);return isNaN(t)?q(e,NaN):(t&&r.setDate(r.getDate()+t),r)}const h={capacityPerSlot:2,weeksAhead:8,timezone:"Europe/London",ageBoundaryForU15:13,slots:{u13:{label:"U13 (Tue 18:30)",time:"18:30",code:"u13"},u15plus:{label:"U15+ (Tue 19:30)",time:"19:30",code:"u15plus"}}};function le(e=2,t=h.weeksAhead){const n=[],r=new Date;let l=new Date(r);const v=(e-l.getDay()+7)%7;l=Y(l,v);for(let b=0;b<t;b++){const c=Y(l,b*7);n.push(c.toISOString().slice(0,10))}return n}function G(e){const t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}function ce(e=6){const t=le(2,e),n=[];for(const r of t)n.push({id:`${r}-u13`,date:r,time:h.slots.u13.time,group:"u13",label:h.slots.u13.label,enabled:!0,booked:!1,slotsLeft:h.capacityPerSlot}),n.push({id:`${r}-u15plus`,date:r,time:h.slots.u15plus.time,group:"u15plus",label:h.slots.u15plus.label,enabled:!0,booked:!1,slotsLeft:h.capacityPerSlot});return n}function ue(e,t){return t?e.filter(n=>n.eligible&&n.enabled):e.filter(n=>n.enabled)}const ge=({inviteToken:e})=>{const[t,n]=y.useState(ce(6)),[r,l]=y.useState(null),[v,b]=y.useState(!1),[c,j]=y.useState(e||null),[S,x]=y.useState(null),[L,w]=y.useState(null),[V,N]=y.useState(!1),[O,P]=y.useState(null),[T,E]=y.useState(!1),[W,B]=y.useState(!1),d=u.useRef(null),I=6e3,z=u.useRef(null);u.useEffect(()=>()=>{d.current&&window.clearTimeout(d.current)},[]),u.useEffect(()=>{try{const i=new URLSearchParams(window.location.search),a=i.get("invite"),f=i.get("date"),g=i.get("slot");if(a&&!c&&j(a),f&&g){const m=t.find(s=>s.date===f&&s.group===g);m&&(l(m),b(!0))}}catch{}},[]),u.useEffect(()=>{async function i(){if(c)try{const a=await fetch(`/api/booking.json?invite=${encodeURIComponent(c)}`),f=await a.json();if(!a.ok||!f.ok){x("Failed to load invite data"),w("error");return}const g=(f.availability||[]).reduce((m,s)=>(m[s.date]=s,m),{});n(m=>m.map(s=>{const p=g[s.date];if(!p)return s;const k=p.slots&&typeof p.slots[s.group]=="number"?p.slots[s.group]:h.capacityPerSlot,Q=p.eligibleSlot===s.group;return{...s,slotsLeft:k,enabled:k>0,eligible:Q}})),f.booking&&(N(!0),P(f.booking),x("You already have a booking — check your email."),w("success"))}catch{x("Failed to fetch availability"),w("error")}}i()},[c]),u.useEffect(()=>{async function i(){if(!c)try{const a=await fetch("/api/booking.json"),f=await a.json();if(!a.ok||!f.ok)return;const g=(f.availability||[]).reduce((m,s)=>(m[s.date]=s,m),{});n(m=>m.map(s=>{const p=g[s.date];if(!p)return s;const k=p.slots&&typeof p.slots[s.group]=="number"?p.slots[s.group]:h.capacityPerSlot;return{...s,slotsLeft:k,enabled:k>0}}))}catch{}}i()},[c]);const _=ue(t,!!c),R=c?t.find(i=>i.eligible)?.label??null:null;u.useEffect(()=>{S&&z.current&&z.current.focus()},[S]);const F=i=>{!i.enabled||i.booked||(l(i),b(!0))},J=()=>{b(!1),l(null)},K=async()=>{if(r&&!T){if(E(!0),c){x("Booking in progress..."),w(null);try{const i=await fetch("/api/booking.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({invite:c,session_date:r.date})}),a=await i.json();if(!i.ok||!a.ok){if(i.status===409&&a.booking){N(!0),P(a.booking),x("A booking already exists for this invite."),w("success");return}throw new Error(a.error||"Booking failed")}n(f=>f.map(g=>g.id===`${r.date}-${r.group}`?{...g,booked:!0,slotsLeft:(g.slotsLeft||1)-1}:g)),N(!0),P(a.booking||null),x("Booking confirmed — check your email for confirmation."),w("success"),B(!0),d.current&&window.clearTimeout(d.current),d.current=window.setTimeout(()=>{window.location.assign("/")},I)}catch(i){x("Booking failed: "+(i?.message||String(i))),w("error")}finally{E(!1),b(!1),l(null)}return}n(i=>i.map(a=>a.id===r.id?{...a,booked:!0}:a)),b(!1),l(null),N(!0),P({id:"local-dev",session_date:r.date,slot:r.group,session_time:r.time}),x("Booking reserved locally (dev mode) — check your email (dev)"),w("success"),B(!0),d.current&&window.clearTimeout(d.current),d.current=window.setTimeout(()=>{window.location.assign("/")},I),E(!1)}};return o.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4 booking-page",children:[o.jsxs("div",{className:"bookings-hero",children:[o.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Book a Training Session"}),o.jsx("p",{className:"bookings-lead",children:"Choose a session below to reserve a free taster. If you received an invite, it will show your eligible slot and held availability."})]}),W&&O?o.jsxs("div",{className:"p-6 mb-6 rounded-lg border-l-4 border-green-500 bg-green-50",role:"status","aria-live":"polite",children:[o.jsx("h3",{className:"text-xl font-semibold",children:"Booking confirmed"}),o.jsxs("p",{className:"mt-2",children:["Your session on ",o.jsx("strong",{children:new Date(O.session_date).toLocaleDateString("en-GB")})," (",h.slots[O.slot]?.label||O.slot,") has been booked. A confirmation email has been sent to the email address you provided when enquiring (check your inbox and spam folder)."]}),o.jsxs("p",{className:"mt-2",children:["You will be returned to the home page in ",Math.round(I/1e3)," seconds."]}),o.jsxs("div",{className:"mt-4",style:{display:"flex",gap:"0.5rem"},children:[o.jsx("button",{onClick:()=>{d.current&&window.clearTimeout(d.current),window.location.assign("/")},className:"btn-primary",children:"Return home now"}),o.jsx("button",{onClick:()=>{B(!1),d.current&&window.clearTimeout(d.current)},className:"btn-ghost",children:"Stay on page"})]})]}):null,o.jsx("div",{"aria-live":"polite","aria-atomic":"true",tabIndex:-1,ref:z,style:{outline:"none"},children:S?o.jsx("div",{className:`p-3 mb-4 rounded ${L==="success"?"status-success":L==="error"?"status-error":"bg-gray-50"}`,role:"status",children:S}):null}),o.jsxs("div",{className:"booking-grid",children:[c?o.jsx("div",{className:"p-3 mb-4 rounded border-l-4 border-blue-500 bg-blue-50",children:R?o.jsxs("p",{className:"small-muted",children:["Showing sessions for ",o.jsx("strong",{children:R}),". If none are listed, it means there are no vacancies in your group."]}):o.jsx("p",{className:"small-muted",children:"You're invited — showing only sessions for your eligible group."})}):null,_.length===0&&c?o.jsx("div",{className:"p-4 mb-4 rounded bg-yellow-50 border border-yellow-200",children:"No eligible sessions with vacancies were found for your group. Please check other dates or contact us."}):null,_.map(i=>o.jsxs("div",{className:`booking-card ${i.booked?"bg-gray-100":""} ${i.eligible?"eligible-card":""}`,onClick:()=>F(i),role:"button",tabIndex:i.enabled&&!i.booked?0:-1,children:[o.jsxs("div",{children:[o.jsxs("div",{className:"booking-meta",children:[o.jsx(se,{style:{color:"var(--blue)"}}),o.jsxs("div",{children:[o.jsx("div",{className:"date",children:G(i.date)}),o.jsxs("div",{className:"time small-muted",children:[i.time," • ",i.label]})]})]}),o.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",alignItems:"center"},children:[o.jsxs("div",{className:"capacity-badge",children:[i.slotsLeft??h.capacityPerSlot," left"]}),i.eligible?o.jsx("div",{className:"eligible-pill",children:"Your slot"}):null,!i.enabled&&!i.booked?o.jsx("div",{className:"small-muted",children:"Full"}):null]})]}),o.jsx("div",{className:"slot-actions",children:o.jsx("button",{onClick:()=>F(i),disabled:!i.enabled||i.booked||V,className:"btn-primary",children:i.booked?"Booked":i.enabled?"Book":"Full"})})]},i.id))]}),v&&r&&o.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 booking-modal-backdrop",children:o.jsxs("div",{className:"card booking-modal",children:[o.jsx("h3",{children:"Confirm Booking"}),o.jsxs("div",{className:"meta-row",children:[o.jsxs("div",{className:"col",children:[o.jsx("strong",{children:"Date:"})," ",G(r.date)]}),o.jsxs("div",{className:"col",children:[o.jsx("strong",{children:"Time:"})," ",r.time]})]}),o.jsxs("p",{className:"mb-4 small-muted",children:["Group: ",r.label]}),o.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[o.jsx("button",{onClick:K,disabled:T,className:"btn-primary",style:{flex:1},children:T?"Booking…":"Confirm booking"}),o.jsx("button",{onClick:J,className:"btn-ghost",style:{flex:1},children:"Cancel"})]})]})})]})};export{ge as default};
