---
import Layout from "../../components/Layout.astro";
import { directus } from "../../lib/directus";
import { readItems } from '@directus/sdk';

const { slug } = Astro.params;

let code = null;
try {
  const response = await directus.request(
    readItems("codes_of_conduct", {
      filter: { slug: { _eq: slug }, published: { _eq: true } },
      limit: 1
    })
  );
  code = response && response.length > 0 ? response[0] : null;
} catch (e) {
  code = null;
}
---

<Layout>
  <div style="max-width:900px;margin:0 auto;padding:0 1.5rem;">
    <section style="padding:3rem 0 2rem 0;">
      {code ? (
        <>
          <h1 class="egac-section-title">{code.title}</h1>
          <p class="egac-section-lead">{code.summary || ''}</p>
          <div class="egac-policy-content" set:html={code.content}></div>
        </>
      ) : (
        <>
          <h1>Code of Conduct Not Found</h1>
          <p>The requested code of conduct could not be found or is not published.</p>
        </>
      )}
    </section>
  </div>
</Layout>
